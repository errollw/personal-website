<!DOCTYPE html>
<html>
<head>
<!-- Load the Paper.js library -->
<script type="text/javascript" src="/js/paper.js"></script>
<!-- Define inlined PaperScript associate it with myCanvas -->
<script type="text/paperscript" canvas="myCanvas">

var full = project.importSVG("/img/all_edges.svg",
  function(item, data) {item.sendToBack()}
)

pts_x_1 = [159, 286, 367, 280, 369, 448, 438, 223, 182, 214, 170, 146, 153, 151, 169, 214, 288, 381, 451, 458, 384, 281, 201, 155, 135, 127, 114, 131, 127, 116, 97, 105, 98, 93, 85, 80, 87, 276, 390, 474, 492, 390, 278, 201, 154, 123, 96, 278, 402, 497, 274, 411, 517, 546, 424, 288, 197, 144, 108, 81, 190, 143, 119, 597, 453, 298, 193, 129, 89, 59, 185, 134, 104, 175, 120, 88, 68, 98, 84, 45, 35, 39, 74, 66, 71, 61, 52, 57, 139, 260, 417, 557, 533, 508, 642, 473, 297, 101, 53, 21, -2, -9, -4, 13, 34, 68, 245, 228, 201, 210, 432, 602, 539, 507, 487, 296, 156, 59, 4, -34, -96, -57, -69, -66, -51, -28, 7, 96, 449, 650, 493, 521, 496, 682, 496, 563, 561, 603, 679, 582, 617, 626, 673, 728, 473, 738, 668, 704, 736, 801, 932, 801, 864, 864, 919, 892, -23, -171, 46, -68, -221, -61, -192, -273, -293, -104, 513, 765, 916, 841, 745, 716, 506, 289, 122, 2, -59, -120, -136, -136, -126, -199, -203, -205, -196, -176, -143, -76, 87, 280, -263, -256, -254, -266, -241, -378, -344, -321, -320, -352, -398, -437, -565, -363, 965, 785, 767, 511, -518, -476, -223, -78, -258, -269, -273, 269, 55, 178, -341, -324, -309, -294, -368, -292, -426, -346, -316, -388, -404]
pts_y_1 = [188, 128, 129, 116, 115, 131, 143, 144, 169, 134, 160, 178, 213, 260, 303, 337, 336, 296, 253, 257, 304, 345, 344, 309, 266, 233, 241, 208, 190, 183, 196, 204, 215, 201, 191, 201, 219, 362, 321, 273, 88, 66, 72, 98, 126, 150, 166, 372, 336, 287, 368, 336, 291, 48, 17, 27, 60, 94, 126, 150, 359, 323, 279, 3, -33, -20, 21, 63, 99, 135, 368, 331, 289, 368, 337, 295, 264, 250, 258, 228, 198, 170, 223, 201, 185, 226, 200, 178, 385, 387, 358, 311, 227, 217, -43, -90, -69, 28, 69, 114, 158, 200, 245, 287, 319, 354, 416, 468, 558, 732, 392, 347, 176, 155, -150, -120, -58, -8, 38, 87, 57, 141, 197, 253, 305, 345, 378, 410, 452, 403, 163, 180, 216, -101, -212, 234, 128, 240, 155, 168, 105, 163, 78, 51, 544, 149, 250, 481, 273, 146, -77, 312, 150, 360, 157, -49, 522, 471, 449, 409, 638, 683, 403, 506, 625, 370, 720, 617, 427, -16, -223, -161, -280, -173, -103, -51, 0, 120, 189, 256, 318, 331, 260, 179, 98, 28, -36, -104, -150, -233, 432, 345, 263, 172, -134, 620, 449, 358, 269, 175, 82, 3, -251, 521, 168, 19, -284, -349, -157, -73, -212, -186, -63, 8, 83, -298, -205, -18, 623, 517, 445, 353, 0, 266, -257, 79, 173, -78, -160]
pts_x_2 = [163, 296, 374, 291, 376, 452, 442, 233, 189, 224, 178, 150, 153, 147, 162, 207, 283, 378, 450, 456, 380, 274, 193, 147, 130, 124, 110, 131, 130, 119, 98, 105, 96, 89, 86, 78, 84, 266, 383, 469, 496, 398, 290, 213, 163, 130, 100, 267, 394, 492, 269, 407, 515, 549, 430, 298, 207, 152, 114, 85, 178, 133, 112, 598, 456, 302, 198, 134, 92, 61, 173, 124, 97, 169, 115, 85, 65, 93, 79, 44, 35, 40, 71, 64, 72, 58, 51, 58, 136, 257, 415, 556, 530, 507, 642, 474, 300, 103, 55, 22, -2, -9, -5, 11, 32, 65, 245, 228, 201, 210, 432, 602, 539, 509, 487, 296, 156, 59, 4, -34, -96, -57, -69, -66, -51, -28, 7, 96, 449, 650, 495, 521, 496, 682, 496, 561, 562, 601, 679, 582, 618, 626, 673, 728, 473, 738, 667, 704, 736, 801, 932, 801, 864, 864, 919, 892, -23, -171, 46, -68, -221, -61, -192, -273, -293, -104, 513, 765, 916, 841, 745, 716, 506, 289, 122, 2, -59, -120, -136, -136, -126, -199, -203, -205, -196, -176, -143, -76, 87, 280, -263, -256, -254, -266, -241, -378, -344, -321, -320, -352, -398, -437, -565, -363, 965, 785, 767, 511, -518, -476, -223, -78, -258, -269, -273, 269, 55, 181, -341, -324, -309, -294, -368, -292, -426, -346, -316, -388, -404]
pts_y_2 = [177, 98, 105, 84, 90, 115, 128, 116, 149, 104, 138, 165, 213, 229, 238, 240, 227, 207, 195, 190, 204, 226, 239, 238, 229, 221, 223, 208, 185, 176, 194, 204, 211, 204, 188, 201, 212, 234, 210, 195, 75, 43, 43, 70, 105, 135, 158, 269, 244, 220, 317, 290, 258, 43, 5, 9, 43, 81, 116, 144, 250, 248, 236, 1, -39, -28, 13, 57, 95, 132, 283, 274, 254, 325, 308, 278, 254, 226, 237, 223, 195, 169, 211, 197, 180, 215, 195, 174, 364, 360, 334, 294, 186, 184, -44, -92, -72, 25, 67, 112, 157, 199, 242, 282, 310, 339, 416, 468, 558, 732, 392, 347, 176, 148, -150, -120, -58, -8, 38, 87, 57, 141, 197, 253, 305, 345, 378, 410, 452, 403, 157, 180, 188, -101, -212, 198, 125, 222, 155, 168, 105, 163, 78, 51, 544, 149, 241, 481, 273, 146, -77, 312, 150, 360, 157, -49, 522, 471, 449, 409, 638, 683, 403, 506, 625, 370, 720, 617, 427, -16, -223, -161, -280, -173, -103, -51, 0, 120, 189, 256, 318, 331, 260, 179, 98, 28, -36, -104, -150, -233, 432, 345, 263, 172, -134, 620, 449, 358, 269, 175, 82, 3, -251, 521, 168, 19, -284, -349, -157, -73, -212, -186, -63, 8, 83, -298, -205, -22, 623, 517, 445, 353, 0, 266, -257, 79, 173, -78, -160]

pts_1 = []
pts_2 = []
for (var i=0; i<pts_x_1.length; i++){
  //if (pts_x_1[i] > 0 && pts_x_1[i] < 640 && pts_y_1[i] > 0 && pts_y_1[i] < 480){
    pts_1.push(new Point(pts_x_1[i], 480-pts_y_1[i]))
    pts_2.push(new Point(pts_x_2[i], 480-pts_y_2[i]))
  //}
}

bounds = new Rectangle(0,0,640,480)

v_pts_grp = new Group([]);
for (var i=0; i<pts_1.length; i++){
  if (!bounds.contains(pts_1[i])) continue;
  var v_pt = new Shape.Circle(pts_1[i], 3);
  v_pt.fillColor = 'red';
  v_pts_grp.addChild(v_pt)
}
v_pts_grp.bringToFront();

v_pts_grp_2 = new Group([]);
for (var i=0; i<pts_x_2.length; i++){
  if (!bounds.contains(pts_1[i])) continue;
  var line = new Path.Line(pts_1[i], pts_1[i]*0.1+pts_2[i]*0.9);
  line.strokeColor = 'red';
  line.strokeWidth = 2;
  var arrowVector = (pts_1[i] - pts_2[i]) * 0.3
  var path2 = new Path({
    segments: [pts_2[i].add(arrowVector.rotate(25)), pts_2[i], pts_2[i].add(arrowVector.rotate(-25)),pts_1[i]+(pts_2[i] - pts_1[i])*0.8],
    fillColor: 'red'            
  }); 
  v_pts_grp_2.addChild(line)
}
v_pts_grp_2.bringToFront();

var offset = new Point(0,500)

for (var px_x=20; px_x<640; px_x+=40){
  for (var px_y=20; px_y<480; px_y+=40){
    px_center = new Point(px_x, px_y)
    dists = []
    for (var i=0; i<pts_1.length; i++){
      dists.push((px_center-pts_1[i]).length)
    }
    var indices = new Array(dists.length);
    for (var i = 0; i < dists.length; ++i) indices[i] = i;
    indices.sort(function (a, b) { return dists[a] < dists[b] ? -1 : dists[a] > dists[b] ? 1 : 0; });

    delta = new Point(0, 0)
    for (var j=0; j<8; j++){
      idx = indices[j]
      delta += (pts_2[idx] - pts_1[idx]) / 8.0
    }
    var pt1 = px_center+offset
    var pt2 = px_center+delta+offset
    var line = new Path.Line(pt1, pt2);
    line.strokeColor = 'red';

    var arrowVector = (pt1 - pt2) * 0.3
    var path2 = new Path({
      segments: [pt2.add(arrowVector.rotate(25)), pt2, pt2.add(arrowVector.rotate(-25)),pt1+(pt2 - pt1)*0.8],
      fillColor: 'red'          
    }); 
  }
}

console.log(project.exportSVG())

</script>
</head>
<body style="margin: 0; overflow: hidden">
  <canvas id="myCanvas" height=1000 width=1000></canvas>
</body>
</html>